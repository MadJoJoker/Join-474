/**
 * Generates the HTML markup for a task overlay.
 *
 * @param {Object} task - The task object containing all task data.
 * @param {string} taskId - The unique identifier for the task.
 * @param {Array<Object>} contacts - The list of contacts assigned or available.
 * @returns {string} HTML string representing the task overlay.
 */
export function getTaskOverlay(task, taskId, contacts) {
  // Hilfsfunktion zur Datumskonvertierung, um den Template-String sauberer zu halten
  const formatDeadline = (deadline) => {
    if (!deadline) return "";
    const parts = deadline.split("."); // ['21', '07', '2025']

    if (parts.length === 3) {
      const isoFormattedDate = `${parts[2]}-${parts[1]}-${parts[0]}`; // "2025-07-21"
      const dateObj = new Date(isoFormattedDate);

      if (!isNaN(dateObj.getTime())) {
        return dateObj
          .toLocaleDateString("de-DE", {
            day: "2-digit",
            month: "2-digit",
            year: "numeric",
          })
          .replace(/\./g, "/"); // Ersetzt Punkte durch Schrägstriche für ein gängigeres Format
      }
    }
    return "";
  };

  const formattedDeadline = formatDeadline(task.deadline);
  const taskPriorityLowerCase = task.priority?.toLowerCase() ?? "";

  return `
    <main class="content-task">
        <div class="taskCardField titleBar">
            <div class="taskType ${
              task.type?.toLowerCase().replace(/\s/g, "-") ?? ""
            }">
                ${task.type ?? ""}
            </div>
        </div>

       <div class="taskCardField titleText">
    ${task.title ?? ""}
</div>
        <div class="taskCardField description">
            <p>${task.description ?? ""}</p>
        </div>

        <div class="taskCardField date">
            <p>Due date:</p>
            <p>${formattedDeadline}</p>
        </div>

        <div class="taskCardField priority-section">
            <p>Priority:</p>
            <div class="priority-display ${taskPriorityLowerCase}"
                 data-priority="${taskPriorityLowerCase}">
                <p>${
                  task.priority
                    ? task.priority.charAt(0).toUpperCase() +
                      task.priority.slice(1)
                    : ""
                }</p>
                <img src="../assets/icons/property/${taskPriorityLowerCase}.svg"
                     alt="${
                       task.priority ? task.priority : "No"
                     } Priority Icon">
            </div>
        </div>

        <div class="taskCardField assigned-section">
            <p class="assigned-title">Assigned To:</p>
            <div class="entryList assigned-list">
                </div>
        </div>

        <div class="taskCardField subtasks-section">
            <p class="subtasks-title">Subtasks:</p>
            <div class="subtaskList">
                </div>
        </div>

        <div class="cardMenu">
            <button class="delete-task-btn" data-task-id="${taskId}">
                <svg width="16" height="18" viewBox="0 0 16 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 18C2.45 18 1.97917 17.8042 1.5875 17.4125C1.19583 17.0208 1 16.55 1 16V3C0.716667 3 0.479167 2.90417 0.2875 2.7125C0.0958333 2.52083 0 2.28333 0 2C0 1.71667 0.0958333 1.47917 0.2875 1.2875C0.479167 1.09583 0.716667 1 1 1H5C5 0.716667 5.09583 0.479167 5.2875 0.2875C5.47917 0.0958333 5.71667 0 6 0H10C10.2833 0 10.5208 0.0958333 10.7125 0.2875C10.9042 0.479167 11 0.716667 11 1H15C15.2833 1 15.5208 1.09583 15.7125 1.2875C15.9042 1.47917 16 1.71667 16 2C16 2.28333 15.9042 2.52083 15.7125 2.7125C15.5208 2.90417 15.2833 3 15 3V16C15 16.55 14.8042 17.0208 14.4125 17.4125C14.0208 17.8042 13.55 18 13 18H3ZM3 3V16H13V3H3ZM5 13C5 13.2833 5.09583 13.5208 5.2875 13.7125C5.47917 13.9042 5.71667 14 6 14C6.28333 14 6.52083 13.9042 6.7125 13.7125C6.90417 13.5208 7 13.2833 7 13V6C7 5.71667 6.90417 5.47917 6.7125 5.2875C6.52083 5.09583 6.28333 5 6 5C5.71667 5 5.47917 5.09583 5.2875 5.2875C5.09583 5.47917 5 5.71667 5 6V13ZM9 13C9 13.2833 9.09583 13.5208 9.2875 13.7125C9.47917 13.9042 9.71667 14 10 14C10.2833 14 10.5208 13.9042 10.7125 13.7125C10.9042 13.5208 11 13.2833 11 13V6C11 5.71667 10.9042 5.47917 10.7125 5.2875C10.5208 5.09583 10.2833 5 10 5C9.71667 5 9.47917 5.09583 9.2875 5.2875C9.09583 5.47917 9 5.71667 9 6V13Z" fill="#2A3647"/>
                </svg>
                <svg width="48" height="13" viewBox="0 0 48 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 12.5H0.409091V0.863636H4.15909C5.28788 0.863636 6.25379 1.09659 7.05682 1.5625C7.85985 2.02462 8.47538 2.68939 8.90341 3.55682C9.33144 4.42045 9.54545 5.45455 9.54545 6.65909C9.54545 7.87121 9.32955 8.91477 8.89773 9.78977C8.46591 10.661 7.83712 11.3314 7.01136 11.8011C6.18561 12.267 5.18182 12.5 4 12.5ZM1.81818 11.25H3.90909C4.87121 11.25 5.66856 11.0644 6.30114 10.6932C6.93371 10.322 7.4053 9.79356 7.71591 9.10795C8.02652 8.42235 8.18182 7.60606 8.18182 6.65909C8.18182 5.7197 8.02841 4.91098 7.72159 4.23295C7.41477 3.55114 6.95644 3.02841 6.34659 2.66477C5.73674 2.29735 4.97727 2.11364 4.06818 2.11364H1.81818V11.25ZM15.3864 12.6818C14.5455 12.6818 13.8201 12.4962 13.2102 12.125C12.6042 11.75 12.1364 11.2273 11.8068 10.5568C11.4811 9.88258 11.3182 9.09848 11.3182 8.20455C11.3182 7.31061 11.4811 6.52273 11.8068 5.84091C12.1364 5.1553 12.5947 4.62121 13.1818 4.23864C13.7727 3.85227 14.4621 3.65909 15.25 3.65909C15.7045 3.65909 16.1534 3.73485 16.5966 3.88636C17.0398 4.03788 17.4432 4.28409 17.8068 4.625C18.1705 4.96212 18.4602 5.40909 18.6761 5.96591C18.892 6.52273 19 7.20833 19 8.02273V8.59091H12.2727V7.43182H17.6364C17.6364 6.93939 17.5379 6.5 17.3409 6.11364C17.1477 5.72727 16.8712 5.42235 16.5114 5.19886C16.1553 4.97538 15.7348 4.86364 15.25 4.86364C14.7159 4.86364 14.2538 4.99621 13.8636 5.26136C13.4773 5.52273 13.1799 5.86364 12.9716 6.28409C12.7633 6.70455 12.6591 7.1553 12.6591 7.63636V8.40909C12.6591 9.06818 12.7727 9.62689 13 10.0852C13.2311 10.5398 13.5511 10.8864 13.9602 11.125C14.3693 11.3598 14.8447 11.4773 15.3864 11.4773C15.7386 11.4773 16.0568 11.428 16.3409 11.3295C16.6288 11.2273 16.8769 11.0758 17.0852 10.875C17.2936 10.6705 17.4545 10.4167 17.5682 10.1136L18.8636 10.4773C18.7273 10.9167 18.4981 11.303 18.1761 11.6364C17.8542 11.9659 17.4564 12.2235 16.983 12.4091C16.5095 12.5909 15.9773 12.6818 15.3864 12.6818ZM22.3807 0.863636V12.5H21.0398V0.863636H22.3807ZM28.4957 12.6818C27.6548 12.6818 26.9295 12.4962 26.3196 12.125C25.7135 11.75 25.2457 11.2273 24.9162 10.5568C24.5904 9.88258 24.4276 9.09848 24.4276 8.20455C24.4276 7.31061 24.5904 6.52273 24.9162 5.84091C25.2457 5.1553 25.7041 4.62121 26.2912 4.23864C26.8821 3.85227 27.5715 3.65909 28.3594 3.65909C28.8139 3.65909 29.2628 3.73485 29.706 3.88636C30.1491 4.03788 30.5526 4.28409 30.9162 4.625C31.2798 4.96212 31.5696 5.40909 31.7855 5.96591C32.0014 6.52273 32.1094 7.20833 32.1094 8.02273V8.59091H25.3821V7.43182H30.7457C30.7457 6.93939 30.6473 6.5 30.4503 6.11364C30.2571 5.72727 29.9806 5.42235 29.6207 5.19886C29.2647 4.97538 28.8442 4.86364 28.3594 4.86364C27.8253 4.86364 27.3632 4.99621 26.973 5.26136C26.5866 5.52273 26.2893 5.86364 26.081 6.28409C25.8726 6.70455 25.7685 7.1553 25.7685 7.63636V8.40909C25.7685 9.06818 25.8821 9.62689 26.1094 10.0852C26.3404 10.5398 26.6605 10.8864 27.0696 11.125C27.4787 11.3598 27.9541 11.4773 28.4957 11.4773C28.848 11.4773 29.1662 11.428 29.4503 11.3295C29.7382 11.2273 29.9863 11.0758 30.1946 10.875C30.4029 10.6705 30.5639 10.4167 30.6776 10.1136L31.973 10.4773C31.8366 10.9167 31.6075 11.303 31.2855 11.6364C30.9635 11.9659 30.5658 12.2235 30.0923 12.4091C29.6188 12.5909 29.0866 12.6818 28.4957 12.6818ZM37.9446 3.77273V4.90909H33.4219V3.77273H37.9446ZM34.7401 1.68182H36.081V10C36.081 10.3788 36.1359 10.6629 36.2457 10.8523C36.3594 11.0379 36.5033 11.1629 36.6776 11.2273C36.8556 11.2879 37.0431 11.3182 37.2401 11.3182C37.3878 11.3182 37.509 11.3106 37.6037 11.2955C37.6984 11.2765 37.7741 11.2614 37.831 11.25L38.1037 12.4545C38.0128 12.4886 37.8859 12.5227 37.723 12.5568C37.5601 12.5947 37.3537 12.6136 37.1037 12.6136C36.7249 12.6136 36.3537 12.5322 35.9901 12.3693C35.6302 12.2064 35.331 11.9583 35.0923 11.625C34.8575 11.2917 34.7401 10.8712 34.7401 10.3636V1.68182ZM43.527 12.6818C42.6861 12.6818 41.9607 12.4962 41.3509 12.125C40.7448 11.75 40.277 11.2273 39.9474 10.5568C39.6217 9.88258 39.4588 9.09848 39.4588 8.20455C39.4588 7.31061 39.6217 6.52273 39.9474 5.84091C40.277 5.1553 40.7353 4.62121 41.3224 4.23864C41.9134 3.85227 42.6027 3.65909 43.3906 3.65909C43.8452 3.65909 44.294 3.73485 44.7372 3.88636C45.1804 4.03788 45.5838 4.28409 45.9474 4.625C46.3111 4.96212 46.6009 5.40909 46.8168 5.96591C47.0327 6.52273 47.1406 7.20833 47.1406 8.02273V8.59091H40.4134V7.43182H45.777C45.777 6.93939 45.6785 6.5 45.4815 6.11364C45.2884 5.72727 45.0118 5.42235 44.652 5.19886C44.2959 4.97538 43.8755 4.86364 43.3906 4.86364C42.8565 4.86364 42.3944 4.99621 42.0043 5.26136C41.6179 5.52273 41.3205 5.86364 41.1122 6.28409C40.9039 6.70455 40.7997 7.1553 40.7997 7.63636V8.40909C40.7997 9.06818 40.9134 9.62689 41.1406 10.0852C41.3717 10.5398 41.6918 10.8864 42.1009 11.125C42.5099 11.3598 42.9853 11.4773 43.527 11.4773C43.8793 11.4773 44.1974 11.428 44.4815 11.3295C44.7694 11.2273 45.0175 11.0758 45.2259 10.875C45.4342 10.6705 45.5952 10.4167 45.7088 10.1136L47.0043 10.4773C46.8679 10.9167 46.6387 11.303 46.3168 11.6364C45.9948 11.9659 45.5971 12.2235 45.1236 12.4091C44.6501 12.5909 44.1179 12.6818 43.527 12.6818Z" fill="#2A3647"/>
                </svg>
            </button>
            <button class="edit-task-btn" data-task-id="${taskId}">
                <svg width="19" height="19" viewBox="0 0 19 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M2 17H3.4L12.025 8.375L10.625 6.975L2 15.6V17ZM16.3 6.925L12.05 2.725L13.45 1.325C13.8333 0.941667 14.3042 0.75 14.8625 0.75C15.4208 0.75 15.8917 0.941667 16.275 1.325L17.675 2.725C18.0583 3.10833 18.2583 3.57083 18.275 4.1125C18.2917 4.65417 18.1083 5.11667 17.725 5.5L16.3 6.925ZM14.85 8.4L4.25 19H0V14.75L10.6 4.15L14.85 8.4Z" fill="#2A3647"/>
                </svg>
                <svg width="28" height="13" viewBox="0 0 28 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M0.409091 12.5V0.863636H7.43182V2.11364H1.81818V6.04545H7.06818V7.29545H1.81818V11.25H7.52273V12.5H0.409091ZM13.0852 12.6818C12.358 12.6818 11.7159 12.4981 11.1591 12.1307C10.6023 11.7595 10.1667 11.2367 9.85227 10.5625C9.53788 9.88447 9.38068 9.08333 9.38068 8.15909C9.38068 7.24242 9.53788 6.44697 9.85227 5.77273C10.1667 5.09848 10.6042 4.57765 11.1648 4.21023C11.7254 3.8428 12.3731 3.65909 13.108 3.65909C13.6761 3.65909 14.125 3.75379 14.4545 3.94318C14.7879 4.12879 15.0417 4.34091 15.2159 4.57955C15.3939 4.81439 15.5322 5.00758 15.6307 5.15909H15.7443V0.863636H17.0852V12.5H15.7898V11.1591H15.6307C15.5322 11.3182 15.392 11.5189 15.2102 11.7614C15.0284 12 14.7689 12.214 14.4318 12.4034C14.0947 12.589 13.6458 12.6818 13.0852 12.6818ZM13.267 11.4773C13.8049 11.4773 14.2595 11.3371 14.6307 11.0568C15.0019 10.7727 15.2841 10.3807 15.4773 9.88068C15.6705 9.37689 15.767 8.79545 15.767 8.13636C15.767 7.48485 15.6723 6.91477 15.483 6.42614C15.2936 5.93371 15.0133 5.55114 14.642 5.27841C14.2708 5.00189 13.8125 4.86364 13.267 4.86364C12.6989 4.86364 12.2254 5.00947 11.8466 5.30114C11.4716 5.58902 11.1894 5.98106 11 6.47727C10.8144 6.9697 10.7216 7.52273 10.7216 8.13636C10.7216 8.75758 10.8163 9.32197 11.0057 9.82955C11.1989 10.3333 11.483 10.7348 11.858 11.0341C12.2367 11.3295 12.7064 11.4773 13.267 11.4773ZM19.7273 12.5V3.77273H21.0682V12.5H19.7273ZM20.4091 2.31818C20.1477 2.31818 19.9223 2.22917 19.733 2.05114C19.5473 1.87311 19.4545 1.65909 19.4545 1.40909C19.4545 1.15909 19.5473 0.945076 19.733 0.767045C19.9223 0.589015 20.1477 0.5 20.4091 0.5C20.6705 0.5 20.8939 0.589015 21.0795 0.767045C21.2689 0.945076 21.3636 1.15909 21.3636 1.40909C21.3636 1.65909 21.2689 1.87311 21.0795 2.05114C20.8939 2.22917 20.6705 2.31818 20.4091 2.31818ZM27.3196 3.77273V4.90909H22.7969V3.77273H27.3196ZM24.1151 1.68182H25.456V10C25.456 10.3788 25.5109 10.6629 25.6207 10.8523C25.7344 11.0379 25.8783 11.1629 26.0526 11.2273C26.2306 11.2879 26.4181 11.3182 26.6151 11.3182C26.7628 11.3182 26.884 11.3106 26.9787 11.2955C27.0734 11.2765 27.1491 11.2614 27.206 11.25L27.4787 12.4545C27.3878 12.4886 27.2609 12.5227 27.098 12.5568C26.9351 12.5947 26.7287 12.6136 26.4787 12.6136C26.0999 12.6136 25.7287 12.5322 25.3651 12.3693C25.0052 12.2064 24.706 11.9583 24.4673 11.625C24.2325 11.2917 24.1151 10.8712 24.1151 10.3636V1.68182Z" fill="#2A3647"/>
                </svg>
            </button>
        </div>
    </main>
  `;
}
