<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Board Site</title>

    <link rel="stylesheet" href="../styles/standard.css" />
    <link rel="stylesheet" href="../styles/colors.css" />
    <link rel="stylesheet" href="../style.css" />
    <link rel="stylesheet" href="../styles/sidebar.css" />
    <link rel="stylesheet" href="../styles/board-site.css" />
    <link rel="stylesheet" href="../assets/fonds/fond.css" />
    <link rel="stylesheet" href="../styles/header.css" />
    <link rel="stylesheet" href="../styles/overlay.css" />
    <link
      rel="icon"
      href="../assets/icons/logo/joinLogo.svg"
      type="image/x-icon"
    />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  </head>

  <body>
    <div class="app-container">
      <section id="sidebar-area"></section>
      <script>
        // Dieses Skript ist ok, da es nur HTML lädt und kein Modul benötigt
        fetch("../js/templates/sidebar.html")
          .then((response) => response.text())
          .then((data) => {
            document.getElementById("sidebar-area").innerHTML = data;
          });
      </script>

      <section class="main-content">
        <header id="header"></header>
        <script>
          // Auch dieses Skript ist ok
          fetch("../js/templates/header.html")
            .then((response) => response.text())
            .then((data) => {
              document.getElementById("header").innerHTML = data;
            });
        </script>
        <div id="overlay-container"></div>

        <main class="content">
          <div class="board-wrapper frame-191">
            <div class="frame-192 board-top-section">
              <h1 class="headline">Board</h1>
              <div class="header-right-controls">
                <div class="frame-121 border-radius-10">
                  <input
                    id="find-task"
                    class="searche-task-web"
                    placeholder="Find Task"
                    type="text"
                  />
                  <div class="seperator"></div>
                  <button type="button" class="search-icon-button">
                    <img
                      src="../assets/icons/btn/search -btn.svg"
                      alt="Search Icon"
                    />
                  </button>
                </div>
                <button id="add-task" class="border-radius-10 dark-blue">
                  <span>Add task</span>
                  <img src="../assets/icons/btn/add.svg" alt="Add Icon" />
                </button>
              </div>
            </div>

            <div id="board-content-wrapper" class="">
              <div class="column-wrapper">
                <div class="width-224 status-item">
                  <button id="fast-add-task-to-do" class="d-flex status-button">
                    <span class="menu-color">To Do</span>
                    <img src="../assets/icons/btn/plus-btn.svg" />
                  </button>
                </div>
                <div id="to-do" class="task-column">
                  <div class="no-tasks-placeholder">No tasks to do</div>
                </div>
              </div>

              <div class="column-wrapper">
                <div class="width-224 status-item">
                  <button
                    id="fast-add-task-in-progress"
                    class="d-flex status-button"
                  >
                    <span class="menu-color">In Progress</span>
                    <img src="../assets/icons/btn/plus-btn.svg" />
                  </button>
                </div>
                <div id="in-progress" class="task-column">
                  <div class="task-card">
                    <div class="category-tag user-story-tag">User Story</div>
                    <div class="task-content">
                      <h3 class="task-title">
                        Kochwelt Page & Recipe Recommender
                      </h3>
                      <p class="task-description">
                        Build start page with recipe recommendation...
                      </p>
                      <div class="progress-container">
                        <div class="progress-bar" style="width: 50%"></div>
                        <span class="subtasks-text">1/2 Subtasks</span>
                      </div>
                    </div>
                    <div class="task-footer">
                      <div class="assigned-users">
                        <div
                          class="assigned-initials-circle"
                          style="background-color: #ff7a00"
                        >
                          AM
                        </div>
                        <div
                          class="assigned-initials-circle"
                          style="background-color: #9327ff"
                        >
                          EM
                        </div>
                        <div
                          class="assigned-initials-circle"
                          style="background-color: #00bee8"
                        >
                          MR
                        </div>
                      </div>
                      <div class="priority-icon">
                        <img
                          src="../assets/icons/medium-priority.svg"
                          alt="Medium Priority"
                        />
                      </div>
                    </div>
                  </div>

                  <div class="task-card">
                    <div class="category-tag user-story-tag">User Story</div>
                    <div class="task-content">
                      <h3 class="task-title">Daily Kochwelt Recipe</h3>
                      <p class="task-description">
                        Implement daily recipe and portion calculator....
                      </p>
                    </div>
                    <div class="task-footer">
                      <div class="assigned-users">
                        <div
                          class="assigned-initials-circle"
                          style="background-color: #fc71ff"
                        >
                          EF
                        </div>
                        <div
                          class="assigned-initials-circle"
                          style="background-color: #ffc701"
                        >
                          AS
                        </div>
                        <div
                          class="assigned-initials-circle"
                          style="background-color: #003eff"
                        >
                          TW
                        </div>
                      </div>
                      <div class="priority-icon">
                        <img
                          src="../assets/icons/medium-priority.svg"
                          alt="Medium Priority"
                        />
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="column-wrapper">
                <div class="width-224 status-item">
                  <button
                    id="fast-add-task-awiat-feedback"
                    class="d-flex status-button"
                  >
                    <span class="menu-color">Await Feedback</span>
                    <img src="../assets/icons/btn/plus-btn.svg" />
                  </button>
                </div>
                <div id="await-feedback" class="task-column">
                  <div class="task-card">
                    <div class="category-tag technical-task-tag">
                      Technical Task
                    </div>
                    <div class="task-content">
                      <h3 class="task-title">HTML Base Template Creation</h3>
                      <p class="task-description">
                        Create reusable HTML base templates...
                      </p>
                    </div>
                    <div class="task-footer">
                      <div class="assigned-users">
                        <div
                          class="assigned-initials-circle"
                          style="background-color: #003eff"
                        >
                          DE
                        </div>
                        <div
                          class="assigned-initials-circle"
                          style="background-color: #1fd7c1"
                        >
                          BZ
                        </div>
                        <div
                          class="assigned-initials-circle"
                          style="background-color: #9327ff"
                        >
                          AS
                        </div>
                      </div>
                      <div class="priority-icon">
                        <img
                          src="../assets/icons/low-priority.svg"
                          alt="Low Priority"
                        />
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="column-wrapper">
                <div class="width-224 status-item">
                  <button id="fast-add-task-done" class="d-flex status-button">
                    <span class="menu-color">Done</span>
                    <img src="../assets/icons/btn/plus-btn.svg" />
                  </button>
                </div>
                <div id="done" class="task-column">
                  <div class="task-card">
                    <div class="category-tag technical-task-tag">
                      Technical Task
                    </div>
                    <div class="task-content">
                      <h3 class="task-title">CSS Architecture Planning</h3>
                      <p class="task-description">
                        Define CSS naming conventions and structure...
                      </p>
                      <div class="progress-container">
                        <div class="progress-bar" style="width: 100%"></div>
                        <span class="subtasks-text">2/2 Subtasks</span>
                      </div>
                    </div>
                    <div class="task-footer">
                      <div class="assigned-users">
                        <div
                          class="assigned-initials-circle"
                          style="background-color: #ffc701"
                        >
                          SM
                        </div>
                        <div
                          class="assigned-initials-circle"
                          style="background-color: #003eff"
                        >
                          BZ
                        </div>
                      </div>
                      <div class="priority-icon">
                        <img
                          src="../assets/icons/high-priority.svg"
                          alt="High Priority"
                        />
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </section>
    </div>

    <script type="module" src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <script type="module" src="../js/events/overlay-handler.js"></script>

    <script type="module">
        // Importiere nur das Nötigste hier, den Rest exponieren wir über window
        import { initOverlayListeners, openOverlay, closeOverlay } from '../js/events/overlay-handler.js';
        import {
            initAddTaskScript,
            clearAddTaskForm,
            openPicker,
            setPriority,
            toggleCategoryDropdown,
            /* weitere Funktionen, die du im Overlay-HTML via onclick aufrufst, z.B. addTask */
        } from '../js/pages/add-task.js'; // Pfad anpassen!

        // Initialisiere die Overlay-Listener, sobald das DOM vollständig geladen ist
        document.addEventListener('DOMContentLoaded', () => {
            // Nach dem dynamischen Laden des Overlays müssen die Listener initialisiert werden
            // Die Fetch-Kette unten kümmert sich darum.

            // Exponiere die Funktionen global für HTML-onclick-Attribute
            window.openOverlay = openOverlay; // Für den Fall, dass du es direkt in HTML aufrufen willst
            window.closeOverlay = closeOverlay; // Für den Fall, dass du es direkt in HTML aufrufen willst

            window.initAddTaskScript = initAddTaskScript;
            window.clearAddTaskForm = clearAddTaskForm;
            window.openPicker = openPicker;
            window.setPriority = setPriority;
            window.toggleCategoryDropdown = toggleCategoryDropdown;
            // Wenn du eine addTask Funktion hast, die du über onclick im Overlay aufrufst:
            // window.addTask = addTask; // Importiere sie zuerst oben und exponiere sie dann hier
        });

        // Dein bestehender Fetch-Aufruf für das Overlay
        fetch("../js/templates/add-task-overlay.html")
            .then((response) => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.text();
            })
            .then((data) => {
                const overlayContainer = document.getElementById("overlay-container");
                if (overlayContainer) {
                    overlayContainer.innerHTML = data;
                    // Initialisiere die Overlay-Listener NACHDEM das Overlay in den DOM geladen wurde
                    initOverlayListeners();
                    // Das addtask script wird durch openOverlay initialisiert
                } else {
                    console.error("Fehler: Das Element #overlay-container wurde nicht im DOM gefunden.");
                }
            })
            .catch((error) =>
                console.error("Fehler beim Laden oder Initialisieren des Overlays:", error)
            );
    </script>

    <script type="module" src="../main.js"></script>
    <script type="module" src="../js/ui/render-board.js"></script>
    <script type="module" src="../js/pages/sidebar.js"></script>
    <script type="module" src="../js/events/overlay-handler.js"></script>
  </body>
</html>
